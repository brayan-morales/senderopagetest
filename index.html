<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>AR Ambientes</title>

  <!-- Librerías principales -->
  <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  <script src="https://raw.githack.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/studio-backend/master/src/modules/marker/tools/gesture-detector.js"></script>
  <script src="https://raw.githack.com/AR-js-org/studio-backend/master/src/modules/marker/tools/gesture-handler.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">

  <a-scene
    maxFPS="30"
    arjs="detectionMode: mono; sourceType: webcam; debugUIEnabled: false; sourceWidth: 640; sourceHeight: 480; displayWidth: 640; displayHeight: 480;"
    embedded
    renderer="logarithmicDepthBuffer: true; precision: medium; antialias: false; powerPreference: low-power;"
    vr-mode-ui="enabled: false"
    gesture-detector
    id="scene"
  >

    <!-- Marcadores con entidades -->
    <a-marker type="pattern" preset="custom" url="marcadores/pattern-11. Pre_Proterozoic_Snowballearth.patt" id="markerIcePlanet">
      <a-entity id="icePlanetKodel" position="0 0.1 0" scale="1 1 1" class="clickable"></a-entity>
    </a-marker>

    <a-marker type="pattern" preset="custom" url="marcadores/pattern-3.Pre_Hádico_creaciónluna.patt" id="markerCollisionPlanet">
      <a-entity id="collisionPlanetKodel" position="0 0.1 0" scale="1 1 1" class="clickable"></a-entity>
    </a-marker>

    <a-marker type="pattern" preset="custom" url="marcadores/pattern-5.-Pre_EarlyArchean.patt" id="markerEarlyArchean">
      <a-entity id="earlyArcheanKodel" position="0 0.1 0" scale="1 1 1" class="clickable"></a-entity>
    </a-marker>

    <a-marker type="pattern" preset="custom" url="marcadores/pattern-Mammuthus primigenius.patt" id="markerMammoth">
      <a-entity id="mammoth1" position="0 0.1 0" scale="1 1 1" class="clickable"></a-entity>
    </a-marker>

    <a-marker type="pattern" preset="custom" url="marcadores/pattern-2.Paleo-Cámbrico-trilobites_paisajesubmarino.patt" id="markerTrilobites">
      <a-entity id="trilobites1" position="0 0.1 0" scale="1 1 1" class="clickable"></a-entity>
    </a-marker>

    <!-- Cámara con cursor/raycaster -->
    <a-entity camera
              cursor="fuse: false; rayOrigin: mouse;"
              raycaster="objects: .clickable"
              emitevents="true">
    </a-entity>

  </a-scene>

  <script>
    const modelConfig = {
      icePlanet: { path: 'modelos/ice planet 3d model.glb', entity: 'icePlanetKodel', marker: 'markerIcePlanet' },
      planetCollision: { path: 'modelos/planet collision 3d model.glb', entity: 'collisionPlanetKodel', marker: 'markerCollisionPlanet' },
      earlyArchean: { path: 'modelos/space planet 3d model.glb', entity: 'earlyArcheanKodel', marker: 'markerEarlyArchean' },
      mammoth: { path: 'modelos/woolly mammoth 3d model.glb', entity: 'mammoth1', marker: 'markerMammoth' },
      trilobites: { path: 'modelos/pill bug 3d model.glb', entity: 'trilobites1', marker: 'markerTrilobites' }
    };

    const loadedModels = {};

    function loadModel(modelKey) {
      if (loadedModels[modelKey]) return;
      const config = modelConfig[modelKey];
      const entity = document.getElementById(config.entity);

      entity.setAttribute('gltf-model', config.path);

      entity.addEventListener('model-loaded', () => {
        loadedModels[modelKey] = true;
        // Activar gestos directamente en el modelo
        entity.setAttribute('gesture-handler', 'minScale: 0.5; maxScale: 3');
        entity.classList.add('clickable');
      }, { once: true });

      entity.addEventListener('model-error', () => {
        console.error("Error cargando modelo:", config.path);
      }, { once: true });
    }

    document.querySelector('a-scene').addEventListener('loaded', () => {
      Object.keys(modelConfig).forEach(modelKey => {
        const config = modelConfig[modelKey];
        const marker = document.getElementById(config.marker);

        marker.addEventListener('markerFound', () => {
          loadModel(modelKey);
        });
      });
    });
  </script>
</body>
</html>