<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>AR Ambientes</title>

  <!-- Librerías principales -->
  <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  <script src="https://raw.githack.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/studio-backend/master/src/modules/marker/tools/gesture-detector.js"></script>
  <script src="https://raw.githack.com/AR-js-org/studio-backend/master/src/modules/marker/tools/gesture-handler.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">

  <a-scene
    maxFPS="30"
    arjs="detectionMode: mono; sourceType: webcam; debugUIEnabled: false; sourceWidth: 640; sourceHeight: 480; displayWidth: 640; displayHeight: 480;"
    embedded
    renderer="logarithmicDepthBuffer: true; precision: medium; antialias: false; powerPreference: low-power;"
    vr-mode-ui="enabled: false"
    gesture-detector
    id="scene"
  >

    <!-- Marcadores con entidades -->
    <a-marker type="pattern" preset="custom" url="marcadores/pattern-11. Pre_Proterozoic_Snowballearth.patt" id="markerIcePlanet">
      <a-entity id="icePlanetKodel" position="0 0.1 0" scale="1 1 1" class="clickable"></a-entity>
    </a-marker>

    <a-marker type="pattern" preset="custom" url="marcadores/pattern-3.Pre_Hádico_creaciónluna.patt" id="markerCollisionPlanet">
      <a-entity id="collisionPlanetKodel" position="0 0.1 0" scale="1 1 1" class="clickable"></a-entity>
    </a-marker>

    <a-marker type="pattern" preset="custom" url="marcadores/pattern-5.-Pre_EarlyArchean.patt" id="markerEarlyArchean">
      <a-entity id="earlyArcheanKodel" position="0 0.1 0" scale="1 1 1" class="clickable"></a-entity>
    </a-marker>

    <a-marker type="pattern" preset="custom" url="marcadores/pattern-Mammuthus primigenius.patt" id="markerMammoth">
      <a-entity id="mammoth1" position="0 0.1 0" scale="1 1 1" class="clickable"></a-entity>
    </a-marker>

    <a-marker type="pattern" preset="custom" url="marcadores/pattern-2.Paleo-Cámbrico-trilobites_paisajesubmarino.patt" id="markerTrilobites">
      <a-entity id="trilobites1" position="0 0.1 0" scale="1 1 1" class="clickable"></a-entity>
    </a-marker>

    <a-marker type="pattern" preset="custom" url="marcadores/pattern-Mes_amonites.patt" id="markerAmmonites">
      <a-entity id="ammonites1" position="0 0.1 0" scale="1 1 1" class="clickable"></a-entity>
    </a-marker>

    <a-marker type="pattern" preset="custom" url="marcadores/pattern-Mes_archelon.patt" id="markerArchelon">
      <a-entity id="archelon1" position="0 0.1 0" scale="1 1 1" class="clickable"></a-entity>
    </a-marker>

    <a-marker type="pattern" preset="custom" url="marcadores/pattern-Bison Priscus.patt" id="markerBisonPriscus">
      <a-entity id="bisonPriscus" position="0 0.1 0" scale="1 1 1" class="clickable"></a-entity>
    </a-marker>

    <a-marker type="pattern" preset="custom" url="marcadores/pattern-Phantera spelaea.patt" id="markerPhanteraSpelaea">
      <a-entity id="phanteraSpelaea" position="0 0.1 0" scale="1 1 1" class="clickable"></a-entity>
    </a-marker>

    <a-marker type="pattern" preset="custom" url="pattern-8. Pre_Proterozoic_Anomalacaris.patt" id="markerAnomalacaris">
      <a-entity id="anomalacaris1" position="0 0.1 0" scale="1 1 1" class="clickable"></a-entity>
    </a-marker>

    <a-marker type="pattern" preset="custom" url="pattern-Mes_cicadas.patt" id="markerCycadaceae">
      <a-entity id="cycadaceae1" position="0 0.1 0" scale="1 1 1" class="clickable"></a-entity>
    </a-marker>

    <a-marker type="pattern" preset="custom" url="pattern-5.Paleo-Carbonífero-libelulagigante.patt" id="markerLibelula">
      <a-entity id="libelula1" position="0 0.1 0" scale="1 1 1" class="clickable"></a-entity>
    </a-marker>
    
    <a-marker type="pattern" preset="custom" url="pattern-Equus Lambei.patt" id="markerHorse">
      <a-entity id="horse1" position="0 0.1 0" scale="1 1 1" class="clickable"></a-entity>
    </a-marker>

    <a-marker type="pattern" preset="custom" url="pattern-Paleo-Devónico-fauna-marina.patt" id="markerFaunaMarina">
      <a-entity id="faunaMarina1" position="0 0.1 0" scale="1 1 1" class="clickable"></a-entity>
    </a-marker>
    <!-- Cámara con cursor/raycaster -->
    <a-entity camera
              cursor="fuse: false; rayOrigin: mouse;"
              raycaster="objects: .clickable"
              emitevents="true">
    </a-entity>

  </a-scene>

  <script>
    const modelConfig = {
      icePlanet: { path: 'modelos/ice planet 3d model.glb', entity: 'icePlanetKodel', marker: 'markerIcePlanet' },
      planetCollision: { path: 'modelos/planet collision 3d model.glb', entity: 'collisionPlanetKodel', marker: 'markerCollisionPlanet' },
      earlyArchean: { path: 'modelos/space planet 3d model.glb', entity: 'earlyArcheanKodel', marker: 'markerEarlyArchean' },
      mammoth: { path: 'modelos/woolly mammoth 3d model.glb', entity: 'mammoth1', marker: 'markerMammoth' },
      trilobites: { path: 'modelos/pill bug 3d model.glb', entity: 'trilobites1', marker: 'markerTrilobites' },
      ammonites: { path: 'modelos/ammonite shell 3d model.glb', entity: 'ammonites1', marker: 'markerAmmonites' },
      archelon: { path: 'modelos/sea turtle 3d model.glb', entity: 'archelon1', marker: 'markerArchelon'},
      bison: { path: 'modelos/steppe bison 3d model.glb', entity: 'bisonPriscus', marker: 'markerBisonPriscus'},
      phantera: { path: 'modelos/panthera fossilis 3d model.glb', entity: 'phanteraSpelaea', marker: 'markerPhanteraSpelaea'},
      anomalacaris: { path: 'modelos/mantis shrimp 3d model.glb', entity: 'anomalacaris1', marker: 'markerAnomalacaris'},
      cycadaceae: { path: 'modelos/cycas pollen cone 3d model.glb', entity: 'cycadaceae1', marker: 'markerCycadaceae'},
      libelula: { path: 'modelos/meganeura 3d model.glb', entity: 'libelula1', marker: 'markerLibelula'},
      horse: { path: 'modelos/prehistoric horse 3d model', entity: 'horse1', marker: 'markerHorse'},
      faunaMarina: { path: 'modelos/ancient marine life 3d model', entity: 'faunaMarina1', marker: 'markerFaunaMarina'}
    };

    const loadedModels = {};

    function loadModel(modelKey) {
      if (loadedModels[modelKey]) return;
      const config = modelConfig[modelKey];
      const entity = document.getElementById(config.entity);

      entity.setAttribute('gltf-model', config.path);

      entity.addEventListener('model-loaded', () => {
        loadedModels[modelKey] = true;
        // Activar gestos directamente en el modelo
        entity.setAttribute('gesture-handler', 'minScale: 0.5; maxScale: 3');
        entity.classList.add('clickable');
      }, { once: true });

      entity.addEventListener('model-error', () => {
        console.error("Error cargando modelo:", config.path);
      }, { once: true });
    }

    document.querySelector('a-scene').addEventListener('loaded', () => {
      Object.keys(modelConfig).forEach(modelKey => {
        const config = modelConfig[modelKey];
        const marker = document.getElementById(config.marker);

        marker.addEventListener('markerFound', () => {
          loadModel(modelKey);
        });
      });
    });
  </script>
</body>
</html>
